<p><span style="font-size: 24pt;"><strong><img class="alignnone size-full wp-image-39020" title="0976c65587ed0a88083cf8144a484958" src="https://linuxword.com/wp-content/uploads/2024/08/0976c65587ed0a88083cf8144a484958.png" alt="0976c65587ed0a88083cf8144a484958" width="1846" height="1077" /></strong></span></p>
<p><span style="font-size: 24pt;"><strong>VmShell开源CentOS 7 配置内部YUM源</strong></span>，<span style="color: #ff6600;"><strong>本YUM源每晚凌晨1点自动获取最新的组件依赖提供自动更新，方便企业内网使用该模板</strong></span>，同时VmShell的YUM源服务器在日本，方便国际网络更新，具体方式如下：<br /><strong>1、备份</strong><br />mkdir /etc/yum.repos.d/backup &amp;&amp; mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup/<br /><strong>2、下载新的</strong> CentOS-Base.repo 到 /etc/yum.repos.d/<br />curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.vmshell.com/repo/CentOS-Base.repo<br />3<strong>、运行 yum clean all &amp;&amp; yum makecache &amp;&amp; yum -y update &amp;&amp; yum -y upgrade 生成缓存并更新依赖</strong><br /><strong>4、运行 yum repolist 查看已经生成缓存</strong></p>
<p><br />重要提醒：当然VmShell也将该YUM源模板提供出来用于大家下载给公司企业内网作为yum源使用（<span style="color: #ff0000;"><strong>解决企业内网服务器更新YUM源的问题，仅仅只需要更换IP即可</strong></span>）：<br /><strong>服务器配置：</strong>4C-4GB-50GB (SSD) ，实际模板文件为35GB大小；<br /><strong>服务器系统</strong>：Centos7.9 64bit<br /><strong>服务器用户名</strong>：root<br /><strong>服务器端口</strong>：22<br /><strong>服务器密码</strong>：000000</p>
<p><span style="color: #ff0000;"><strong>下载地址</strong></span>：  <a href="https://linuxword.com/wp-content/uploads/PVE/CentOS7-YUM.zip" target="_blank" rel="noopener">https://linuxword.com/wp-content/uploads/PVE/CentOS7-YUM.zip</a><br />如果想自己生成具体模板制作文档请见教程：<a href="https://linuxword.com/?p=38887" target="_blank" rel="noopener">VmShell国际CentOS源服务器[解决阿里源速度慢问题]</a></p>
<p> </p>
<p><img class="alignnone size-full wp-image-38888" title="6b189e0c0b3cd3660caf4800bd9a3e42.jpeg@wm_2t_55m_5a625Y_3L_mZiOaXreWNjgfc_ffffffff_U2ltSGVpsz_2" src="https://linuxword.com/wp-content/uploads/2024/08/6b189e0c0b3cd3660caf4800bd9a3e42.jpeg@wm_2t_55m_5a625Y_3L_mZiOaXreWNjgfc_ffffffff_U2ltSGVpsz_2.jpg" sizes="(max-width: 1024px) 100vw, 1024px" srcset="https://linuxword.com/wp-content/uploads/2024/08/6b189e0c0b3cd3660caf4800bd9a3e42.jpeg@wm_2t_55m_5a625Y_3L_mZiOaXreWNjgfc_ffffffff_U2ltSGVpsz_2.jpg 1024w, https://linuxword.com/wp-content/uploads/2024/08/6b189e0c0b3cd3660caf4800bd9a3e42.jpeg@wm_2t_55m_5a625Y_3L_mZiOaXreWNjgfc_ffffffff_U2ltSGVpsz_2-768x576.jpg 768w" alt="6b189e0c0b3cd3660caf4800bd9a3e42.jpeg@wm_2t_55m_5a625Y_3L_mZiOaXreWNjgfc_ffffffff_U2ltSGVpsz_2" width="1024" height="768" /></p>
<p>1、由于CentoS7源停止了更新，阿里源在线更新速度太慢，也缺少第三方yum源，因此基于VmShell国际线路搭建一台yum源服务器满足这一需求，同时网络层面策略只允许此yum源服务器每周日晚限时联网同步阿里云的yum源保持最新。<br />2、准备亚洲服务器用作yum源服务器。<br />3、系统版本：CentOS 7.9<br />实操步骤：<br />一、添加阿里云yum源<br />备份原系统的repo<br />mkdir /etc/yum.repos.d/backup &amp;&amp; mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup &amp;&amp; screen -S centos<br />添加阿里云yum源并缓存（Centos-7.repo是软件仓库配置文件，epel-7.repo是扩展源、提供额外的软件包）<br />curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo &amp;&amp; curl -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo &amp;&amp; yum clean all &amp;&amp; yum makecache &amp;&amp; yum repolist</p>
<p><img class="alignnone size-full wp-image-38891" title="9122d73863b82afbd1433ce23c9e24c1" src="https://linuxword.com/wp-content/uploads/2024/08/9122d73863b82afbd1433ce23c9e24c1.png" sizes="(max-width: 1114px) 100vw, 1114px" srcset="https://linuxword.com/wp-content/uploads/2024/08/9122d73863b82afbd1433ce23c9e24c1.png 1114w, https://linuxword.com/wp-content/uploads/2024/08/9122d73863b82afbd1433ce23c9e24c1-1024x465.png 1024w, https://linuxword.com/wp-content/uploads/2024/08/9122d73863b82afbd1433ce23c9e24c1-768x349.png 768w" alt="9122d73863b82afbd1433ce23c9e24c1" width="1114" height="506" /><br />二、安装相关软件：<br />yum -y update &amp;&amp; yum -y upgrade &amp;&amp; yum -y install python-gobject python-firewall wget make cmake gcc gcc-c++ pcre-devel zlib-devel openssl openssl-devel httpd yum-utils createrepo<br />备注：yum-utils：yum-utils是yum的工具包集合，reposync一个同步工具。<br />createrepo：createrepo是一个对rpm文件进行索引建立的工具，就是对指定目录下的rpm文件进行检索，把每个rpm文件的信息存储到指定的索引文件中，这样方便远程yum命令在安装更新时进行检索。<br />httpd：通过Apache软件提供web服务，也可以使用nginx。</p>
<p><img class="alignnone size-full wp-image-38892" title="fae3862a7ee3085679ab4c9c5888830c" src="https://linuxword.com/wp-content/uploads/2024/08/fae3862a7ee3085679ab4c9c5888830c.png" sizes="(max-width: 1106px) 100vw, 1106px" srcset="https://linuxword.com/wp-content/uploads/2024/08/fae3862a7ee3085679ab4c9c5888830c.png 1106w, https://linuxword.com/wp-content/uploads/2024/08/fae3862a7ee3085679ab4c9c5888830c-1024x695.png 1024w, https://linuxword.com/wp-content/uploads/2024/08/fae3862a7ee3085679ab4c9c5888830c-768x521.png 768w" alt="fae3862a7ee3085679ab4c9c5888830c" width="1106" height="751" /><br />三、同步阿里云yum源软件包到本地服务器指定目录/mirror（自定义目录） :<br />创建用户apache存放软件包目录/mirror，（chown设置文件所有者和文件关联组，chmod控制用户对文件的权限）<br />mkdir -p /mirror<br />chown -R apache:apache /mirror<br />chmod -R 755 /mirror</p>
<p>同步阿里云yum源软件包<br />参数-n指下载最新软件包，-p指定目录，指定本地的源--repoid（如果不指定就同步本地服务器所有的源）,下载过程比较久（10个小时左右）<br />reposync -n --repoid=extras --repoid=updates --repoid=base --repoid=epel -p /mirror<br />我们可以输入该命令显示目录文件夹大小: du -sh /mirror/*</p>
<p><img class="alignnone size-full wp-image-38962" title="4d4f600a7aa0fc48765ef330619057ee" src="https://linuxword.com/wp-content/uploads/2024/08/4d4f600a7aa0fc48765ef330619057ee.png" alt="4d4f600a7aa0fc48765ef330619057ee" width="276" height="101" /><br />四、创建仓库索引<br />createrepo -po /mirror/base/ /mirror/base/<br />createrepo -po /mirror/extras/ /mirror/extras/<br />createrepo -po /mirror/updates/ /mirror/updates/<br />createrepo -po /mirror/epel/ /mirror/epel/</p>
<p><img class="alignnone size-full wp-image-38964" title="dad17cf5a9b90b5cf4c622548baa0a77" src="https://linuxword.com/wp-content/uploads/2024/08/dad17cf5a9b90b5cf4c622548baa0a77.png" alt="dad17cf5a9b90b5cf4c622548baa0a77" width="689" height="530" /><br />五、更新数据源<br />createrepo --update /mirror/base/<br />createrepo --update /mirror/extras/<br />createrepo --update /mirror/updates/<br />createrepo --update /mirror/epel/</p>
<p><img class="alignnone size-full wp-image-38965" title="2b8ec52bad1f661655507b3f752c82f2" src="https://linuxword.com/wp-content/uploads/2024/08/2b8ec52bad1f661655507b3f752c82f2.png" sizes="(max-width: 827px) 100vw, 827px" srcset="https://linuxword.com/wp-content/uploads/2024/08/2b8ec52bad1f661655507b3f752c82f2.png 827w, https://linuxword.com/wp-content/uploads/2024/08/2b8ec52bad1f661655507b3f752c82f2-768x579.png 768w" alt="2b8ec52bad1f661655507b3f752c82f2" width="827" height="624" /><br />六、启动并配置Apache服务<br />yum install -y httpd<br />6.1、启动Apache（httpd）服务<br />systemctl start httpd<br />systemctl enable httpd<br />systemctl status httpd</p>
<p><img class="alignnone size-full wp-image-38987" title="1885aa3afcbb19495324d241f7020fd4" src="https://linuxword.com/wp-content/uploads/2024/08/1885aa3afcbb19495324d241f7020fd4.png" sizes="(max-width: 1326px) 100vw, 1326px" srcset="https://linuxword.com/wp-content/uploads/2024/08/1885aa3afcbb19495324d241f7020fd4.png 1326w, https://linuxword.com/wp-content/uploads/2024/08/1885aa3afcbb19495324d241f7020fd4-1024x656.png 1024w, https://linuxword.com/wp-content/uploads/2024/08/1885aa3afcbb19495324d241f7020fd4-768x492.png 768w, https://linuxword.com/wp-content/uploads/2024/08/1885aa3afcbb19495324d241f7020fd4-220x140.png 220w" alt="1885aa3afcbb19495324d241f7020fd4" width="1326" height="849" /><br />6.2、系统防火墙放行80端口（apache服务使用的是80和443端口）<br />firewall-cmd --permanent --zone=public --add-port=80/tcp<br />firewall-cmd --permanent --zone=public --add-port=443/tcp<br />success<br />firewall-cmd --reload<br />success</p>
<p><img class="alignnone size-full wp-image-38988" title="64b2d8960733970efd981fcfee6d3ee9" src="https://linuxword.com/wp-content/uploads/2024/08/64b2d8960733970efd981fcfee6d3ee9.png" sizes="(max-width: 2560px) 100vw, 2560px" srcset="https://linuxword.com/wp-content/uploads/2024/08/64b2d8960733970efd981fcfee6d3ee9.png 2560w, https://linuxword.com/wp-content/uploads/2024/08/64b2d8960733970efd981fcfee6d3ee9-1024x582.png 1024w, https://linuxword.com/wp-content/uploads/2024/08/64b2d8960733970efd981fcfee6d3ee9-768x436.png 768w, https://linuxword.com/wp-content/uploads/2024/08/64b2d8960733970efd981fcfee6d3ee9-1536x872.png 1536w, https://linuxword.com/wp-content/uploads/2024/08/64b2d8960733970efd981fcfee6d3ee9-2048x1163.png 2048w" alt="64b2d8960733970efd981fcfee6d3ee9" width="2560" height="1454" /><br />备注：必要时可以运行 systemctl restart httpd 重启一下服务。<br />6.3、关闭selinux（SELINUX=disabled），方法：1、利用“vim /etc/sysconfig/selinux”命令打开selinux文件；2、将文件中的“SELINUX=enforcing”修改为“SELINUX=disabled”；3、修改保存后，重新启动即可。</p>
<p><img class="alignnone size-full wp-image-38990" title="26ef44596ccd1f1065acf3a7765d924c" src="https://linuxword.com/wp-content/uploads/2024/08/26ef44596ccd1f1065acf3a7765d924c.png" sizes="(max-width: 970px) 100vw, 970px" srcset="https://linuxword.com/wp-content/uploads/2024/08/26ef44596ccd1f1065acf3a7765d924c.png 970w, https://linuxword.com/wp-content/uploads/2024/08/26ef44596ccd1f1065acf3a7765d924c-768x673.png 768w" alt="26ef44596ccd1f1065acf3a7765d924c" width="970" height="850" /><br />6.4、配置httpd.conf文件<br />文件路径/etc/httpd/conf/httpd.conf<br />DocumentRoot "/mirror/"<br />&lt;Directory "/mirror/"&gt;<br />Options Indexes FollowSymLinks<br />AllowOverride None<br />Order allow,deny<br />Allow from all<br />Require all granted<br /><br />注意：上面配置的httpd.conf文件，需要找到如下图DocumentRoot字样的行进行更改，而不是直接复制粘贴插入。</p>
<p><img class="alignnone size-full wp-image-38993" title="2419627-20230307175225756-1708326104" src="https://linuxword.com/wp-content/uploads/2024/08/2419627-20230307175225756-1708326104.png" sizes="(max-width: 1304px) 100vw, 1304px" srcset="https://linuxword.com/wp-content/uploads/2024/08/2419627-20230307175225756-1708326104.png 1304w, https://linuxword.com/wp-content/uploads/2024/08/2419627-20230307175225756-1708326104-1024x397.png 1024w, https://linuxword.com/wp-content/uploads/2024/08/2419627-20230307175225756-1708326104-768x298.png 768w" alt="2419627-20230307175225756-1708326104" width="1304" height="506" /><br />6.5、修改web界面的 index.html 文件<br />###修改Apache默认首页index.html，直接复制粘贴执行<br />cat &lt;&lt; EOF &gt; /usr/share/httpd/noindex/index.html<br /><br /><br /><br /><br /><br /></p>
<p><br /><br /></p>
<h1>简介</h1>
<p> </p>
<hr />
<p> </p>
<p>CentOS，是基于 Red Hat Linux 提供的可自由使用源代码的企业级 Linux 发行版本，是一个稳定，可预测，可管理和可复制的免费企业级计算平台,官方停止源更新后,VmShell提供开源地址提供用户升级</p>
<p> </p>
<hr />
<p><br /><br /><br /><br /></p>
<p> </p>
<h1>VmShell开源CentOS 7 配置内部YUM源</h1>
<p><br /><br /><br /></p>
<h2>1、备份</h2>
<p><br />mkdir /etc/yum.repos.d/backup<br />mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup/<br /><br /><br /></p>
<h2>2、下载新的 CentOS-Base.repo 到 /etc/yum.repos.d/</h2>
<p><br />curl -o /etc/yum.repos.d/CentOS-Base.repo http://23.173.216.66/repo/CentOS-Base.repo<br /><br /><br /></p>
<h2>3、运行 yum clean all &amp;&amp; yum makecache &amp;&amp; yum -y update &amp;&amp; yum -y upgrade 生成缓存并更新依赖</h2>
<p><br /><br /><br /></p>
<h2>4、运行 yum repolist 查看已经生成缓存</h2>
<p><br /><br /><br /><br /></p>
<p> </p>
<div class="copyright"><br />© 版权所有: <a href="https://vmshell.com/" target="_blank" rel="noopener">VmShell INC</a></div>
<p><br /><br /><br />EOF<br />注意： 上文中的 http://mirrors.vmshell.com 填写自身yum源服务器的ip地址。<br />七、编写yum源客户端配置文件<br />创建repo文件夹<br />mkdir -p /mirror/repo/<br />###复制粘贴执行,注意：mirrors.vmshell.com需要更改为服务器ip地址。</p>
<p>cat &lt;&lt; EOF &gt; /mirror/repo/CentOS-Base.repo</p>
<p>[base]<br />name=CentOS- Base - mirrors.vmshell.com<br />failovermethod=priority<br />baseurl=http://mirrors.vmshell.com/base/<br />enable=1<br />gpgcheck=0</p>
<p>#released updates <br />[updates]<br />name=CentOS- Updates - mirrors.vmshell.com<br />failovermethod=priority<br />baseurl=http://mirrors.vmshell.com/updates/<br />enable=1<br />gpgcheck=0</p>
<p>#additional packages that may be useful<br />[extras]<br />name=CentOS- Extras - mirrors.vmshell.com<br />failovermethod=priority<br />baseurl=http://mirrors.vmshell.com/extras/<br />enable=1<br />gpgcheck=0</p>
<p>#additional packages that may be useful<br />[epel]<br />name=CentOS- Epel - mirrors.vmshell.com<br />failovermethod=priority<br />baseurl=http://mirrors.vmshell.com/epel/<br />enable=1<br />gpgcheck=0<br />EOF</p>
<p>八、客户端配置yum源 <br />登录客户端操作系统执行以下命令（注意：mirrors.vmshell.com为yum源服务器的ip地址）<br />mkdir /etc/yum.repos.d/backup/<br />mv /etc/yum.repos.d/* /etc/yum.repos.d/backup/<br />curl -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.vmshell.com/repo/CentOS-Base.repo<br />yum makecache<br />用户也可以用浏览器访问 <a href="http://mirrors.vmshell.com/" target="_blank" rel="noopener">http://mirrors.vmshell.com</a> 查看配置客户端yum源的方法</p>
<p><img class="alignnone size-full wp-image-38995" title="ab46d5cc29fa19bb59e2a7cde1d5cd66" src="https://linuxword.com/wp-content/uploads/2024/08/ab46d5cc29fa19bb59e2a7cde1d5cd66.png" sizes="(max-width: 2560px) 100vw, 2560px" srcset="https://linuxword.com/wp-content/uploads/2024/08/ab46d5cc29fa19bb59e2a7cde1d5cd66.png 2560w, https://linuxword.com/wp-content/uploads/2024/08/ab46d5cc29fa19bb59e2a7cde1d5cd66-1024x582.png 1024w, https://linuxword.com/wp-content/uploads/2024/08/ab46d5cc29fa19bb59e2a7cde1d5cd66-768x436.png 768w, https://linuxword.com/wp-content/uploads/2024/08/ab46d5cc29fa19bb59e2a7cde1d5cd66-1536x872.png 1536w, https://linuxword.com/wp-content/uploads/2024/08/ab46d5cc29fa19bb59e2a7cde1d5cd66-2048x1163.png 2048w" alt="ab46d5cc29fa19bb59e2a7cde1d5cd66" width="2560" height="1454" /><br />九 、设置定时同步yum源的任务<br />编辑脚本<br />mkdir /opt/script/cron &amp;&amp; vim /opt/script/cron/centos_yum_update.sh<br />#!/bin/bash<br />echo 'Updating Aliyum Source'<br />DATETIME=`date +%F_%T`<br />exec &gt; /var/log/aliyumrepo_$DATETIME.log<br />reposync -np /mirror<br />if [ $? -eq 0 ];then<br />createrepo --update /mirror/base<br />createrepo --update /mirror/extras<br />createrepo --update /mirror/updates<br />createrepo --update /mirror/epel<br />echo "SUCESS: $DATETIME aliyum_yum update successful"<br />else<br />echo "ERROR: $DATETIME aliyum_yum update failed"<br />fi<br />添加定时任务,每周一凌晨1点执行:   crontab -e<br />0 1 * * 1 /bin/bash /mirror/script/centos_yum_update.sh<br />至此，结束。。。</p>
<p><img class="alignnone size-full wp-image-38996" title="97ea85fc79b374d1a74ae165c80acaed" src="https://linuxword.com/wp-content/uploads/2024/08/97ea85fc79b374d1a74ae165c80acaed.png" sizes="(max-width: 1001px) 100vw, 1001px" srcset="https://linuxword.com/wp-content/uploads/2024/08/97ea85fc79b374d1a74ae165c80acaed.png 1001w, https://linuxword.com/wp-content/uploads/2024/08/97ea85fc79b374d1a74ae165c80acaed-768x651.png 768w" alt="97ea85fc79b374d1a74ae165c80acaed" width="1001" height="849" /><br />问题：有时服务器端的yum源仓库索引没有更新成功。<br />手动更新：<br />createrepo --update /mirror/base/<br />createrepo --update /mirror/extras/<br />createrepo --update /mirror/updates/<br />createrepo --update /mirror/epel/</p>
